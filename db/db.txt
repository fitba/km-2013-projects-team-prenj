CREATE DATABASE kms;

USE kms;

CREATE TABLE IF NOT EXISTS `tags` (
  `TagID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(50) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,
  `Description` text CHARACTER SET utf8 COLLATE utf8_unicode_ci,
  PRIMARY KEY (`TagID`),
  UNIQUE KEY `Name` (`Name`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;


CREATE TABLE IF NOT EXISTS `users` (
  `UserID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FirstName` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `LastName` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `Username` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `Password` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `Email` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `ProfilePicture` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `Location` varchar(200) COLLATE utf8_unicode_ci DEFAULT NULL,
  `WebSite` varchar(100) COLLATE utf8_unicode_ci DEFAULT NULL,
  `DateOfBirth` date COLLATE utf8_unicode_ci DEFAULT NULL,
  `AboutSelf` text COLLATE utf8_unicode_ci DEFAULT NULL,
  `Sex` enum('m','f') COLLATE utf8_unicode_ci NOT NULL,
  `RegistrationDate` datetime NOT NULL,
  `Key` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `ConfirmAccount` tinyint(1) NOT NULL DEFAULT '0',
  `UserType` enum('admin','user') COLLATE utf8_unicode_ci NOT NULL DEFAULT 'user',
  PRIMARY KEY (`UserID`),
  UNIQUE KEY `Email` (`Email`),
  UNIQUE KEY `Username` (`Username`),
  UNIQUE KEY `Key` (`Key`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `questions` (
  `QuestionID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `Title` varchar(250) COLLATE utf8_unicode_ci NOT NULL,
  `Question` text COLLATE utf8_unicode_ci NOT NULL,
  `AskDate` datetime NOT NULL,
  `UserID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`QuestionID`),
  CONSTRAINT `fk_questions_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1;

CREATE TABLE IF NOT EXISTS `answers` (
  `AnswerID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int(10) unsigned NOT NULL,
  `QuestionID` bigint(20) unsigned NOT NULL,
  `AnswerDate` datetime NOT NULL,
  `Answer` text COLLATE utf8_unicode_ci NOT NULL,
  `Best` enum('0','1') DEFAULT 0 NOT NULL,
  PRIMARY KEY (`AnswerID`),
  CONSTRAINT `fk_answers_questions` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`),
  CONSTRAINT `fk_answers_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;


CREATE TABLE IF NOT EXISTS `articles` (
  `ArticleID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `Title` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `Content` text COLLATE utf8_unicode_ci NOT NULL,
  `UserID` int(10) unsigned NOT NULL,
  `PostDate` datetime NOT NULL,
  PRIMARY KEY (`ArticleID`),
  CONSTRAINT `fk_articles_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;



CREATE TABLE IF NOT EXISTS `article_tags` (
  `ArticleID` bigint(20) unsigned NOT NULL,
  `TagID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ArticleID`,`TagID`),
  CONSTRAINT `fk_article_tags_articles` FOREIGN KEY (`ArticleID`) REFERENCES `articles` (`ArticleID`),
  CONSTRAINT `fk_article_tags_tags` FOREIGN KEY (`TagID`) REFERENCES `tags` (`TagID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;



CREATE TABLE IF NOT EXISTS `comments` (
  `CommentID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `Ordinal` bigint(20) unsigned NOT NULL,
  `CommentDate` datetime NOT NULL,
  `Comment` text COLLATE utf8_unicode_ci NOT NULL,
  `UserID` int(10) unsigned NOT NULL,
  `QuestionID` bigint(20) unsigned DEFAULT NULL,
  `AnswerID` bigint(20) unsigned DEFAULT NULL,
  `ArticleID` bigint(20) unsigned DEFAULT NULL,
  PRIMARY KEY (`CommentID`),
  CONSTRAINT `fk_comments_answers` FOREIGN KEY (`AnswerID`) REFERENCES `answers` (`AnswerID`),
  CONSTRAINT `fk_comments_questions` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`),
  CONSTRAINT `fk_comments_articles` FOREIGN KEY (`ArticleID`) REFERENCES `articles` (`ArticleID`),
  CONSTRAINT `fk_comments_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;



CREATE TABLE IF NOT EXISTS `follow_tags` (
  `UserID` int(10) unsigned NOT NULL,
  `TagID` int(11) unsigned NOT NULL,
  PRIMARY KEY (`UserID`,`TagID`),
  CONSTRAINT `fk_follow_tags_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`),
  CONSTRAINT `fk_follow_tags_tags` FOREIGN KEY (`TagID`) REFERENCES `tags` (`TagID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

CREATE TABLE IF NOT EXISTS `logs` (
  `LogID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int(10) unsigned NOT NULL,
  `LogDate` datetime NOT NULL,
  `AnswerID` bigint(20) unsigned DEFAULT NULL,
  `QuestionID` bigint(20) unsigned DEFAULT NULL,
  `ArticleID` bigint(20) unsigned DEFAULT NULL,
  PRIMARY KEY (`LogID`),
  CONSTRAINT `fk_logs_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`),
  CONSTRAINT `fk_logs_answers` FOREIGN KEY (`AnswerID`) REFERENCES `answers` (`AnswerID`),
  CONSTRAINT `fk_logs_articles` FOREIGN KEY (`ArticleID`) REFERENCES `articles` (`ArticleID`),
  CONSTRAINT `fk_logs_questions` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1;


CREATE TABLE IF NOT EXISTS `question_tags` (
  `QuestionID` bigint(20) unsigned NOT NULL,
  `TagID` int(11) unsigned NOT NULL,
  PRIMARY KEY (`QuestionID`,`TagID`),
  CONSTRAINT `fk_question_tags_questions` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`),
  CONSTRAINT `fk_question_tags_tags` FOREIGN KEY (`TagID`) REFERENCES `tags` (`TagID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `views` (
  `ViewID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int(10) unsigned DEFAULT NULL,
  `QuestionID` bigint(20) unsigned DEFAULT NULL,
  `ArticleID` bigint(20) unsigned DEFAULT NULL,
  `IPAddress` varchar(15) CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT NULL,
  PRIMARY KEY (`ViewID`),
  CONSTRAINT `fk_views_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`),
  CONSTRAINT `fk_views_questions` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`),
  CONSTRAINT `fk_views_articles` FOREIGN KEY (`ArticleID`) REFERENCES `articles` (`ArticleID`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;


CREATE TABLE IF NOT EXISTS `votes` (
  `VoteID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int(10) unsigned NOT NULL,
  `QuestionID` bigint(20) unsigned DEFAULT NULL,
  `AnswerID` bigint(20) unsigned DEFAULT NULL,
  `ArticleID` bigint(20) unsigned DEFAULT NULL,
  `Positive` enum('0','1') COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`VoteID`),
  CONSTRAINT `fk_votes_answers` FOREIGN KEY (`AnswerID`) REFERENCES `answers` (`AnswerID`),
  CONSTRAINT `fk_votes_questions` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`),
  CONSTRAINT `fk_votes_users` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`),
  CONSTRAINT `fk_votes_articles` FOREIGN KEY (`ArticleID`) REFERENCES `articles` (`ArticleID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE DATABASE kms;

USE kms;

CREATE TABLE IF NOT EXISTS `users` (
  `UserID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FirstName` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `LastName` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `Username` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `Password` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `Email` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `ProfilePicture` varchar(100) COLLATE utf8_unicode_ci,
  `Sex` enum('m','f') COLLATE utf8_unicode_ci NOT NULL,
  `RegistrationDate` datetime NOT NULL,
  `Key` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `ConfirmAccount` tinyint(1) NOT NULL DEFAULT '0',
  `UserType` enum('admin','user') COLLATE utf8_unicode_ci NOT NULL DEFAULT 'user',
  PRIMARY KEY (`UserID`),
  UNIQUE KEY `Email` (`Email`),
  UNIQUE KEY `Username` (`Username`),
  UNIQUE KEY `Key` (`Key`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `questions` (
  `QuestionID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `Title` varchar(250) COLLATE utf8_unicode_ci NOT NULL,
  `Tags` varchar(250) COLLATE utf8_unicode_ci NOT NULL,
  `Question` text COLLATE utf8_unicode_ci NOT NULL,
  `AskDate` datetime NOT NULL,
  `Views` int unsigned DEFAULT 0,
  `UserID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`QuestionID`),
  CONSTRAINT fk_questions_users FOREIGN KEY(UserID) REFERENCES users(UserID)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `answers` (
  `AnswerID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int unsigned NOT NULL,
  `QuestionID` bigint unsigned NOT NULL,
  `AnswerDate` datetime NOT NULL,
  `Answer` text COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`AnswerID`),
  CONSTRAINT fk_answers_questions FOREIGN KEY(`QuestionID`) REFERENCES questions(`QuestionID`),
  CONSTRAINT fk_answers_users FOREIGN KEY(`UserID`) REFERENCES users(`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `comments` (
  `CommentID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `Ordinal` bigint unsigned NOT NULL,
  `CommentDate` datetime NOT NULL,
  `Comment` text COLLATE utf8_unicode_ci NOT NULL,
  `UserID` int unsigned NOT NULL,
  `QuestionID` bigint unsigned,
  `AnswerID` bigint unsigned,
  PRIMARY KEY (`CommentID`),
  CONSTRAINT fk_comments_questions FOREIGN KEY(`QuestionID`) REFERENCES questions(`QuestionID`),
  CONSTRAINT fk_comments_answers FOREIGN KEY(`AnswerID`) REFERENCES answers(`AnswerID`),
  CONSTRAINT fk_comments_users FOREIGN KEY(`UserID`) REFERENCES users(`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `votes` (
  `VoteID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int unsigned NOT NULL,
  `QuestionID` bigint unsigned,
  `AnswerID` bigint unsigned,
  `Positive` ENUM('0', '1') NOT NULL,
  PRIMARY KEY (`VoteID`),
  CONSTRAINT fk_votes_questions FOREIGN KEY(`QuestionID`) REFERENCES questions(`QuestionID`),
  CONSTRAINT fk_votes_answers FOREIGN KEY(`AnswerID`) REFERENCES answers(`AnswerID`),
  CONSTRAINT fk_votes_users FOREIGN KEY(`UserID`) REFERENCES users(`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `tags` (
  `TagID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(50) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,
  `Description` text CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`TagID`),
  UNIQUE KEY `Name` (`Name`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `question_tags` (
  `QuestionID` bigint(20) unsigned NOT NULL,
  `TagID` int(11) unsigned NOT NULL,
  PRIMARY KEY (`QuestionID`,`TagID`),
  KEY `QuestionID` (`QuestionID`),
  KEY `TagID` (`TagID`),
  CONSTRAINT `question_tags_ibfk_2` FOREIGN KEY (`TagID`) REFERENCES `tags` (`TagID`),
  CONSTRAINT `question_tags_ibfk_1` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `follow_tags` (
  `UserID` int(10) unsigned NOT NULL,
  `TagID` int(11) unsigned NOT NULL,
  PRIMARY KEY (`UserID`,`TagID`),
  KEY `UserID` (`UserID`),
  KEY `TagID` (`TagID`),
  CONSTRAINT `users_tags_ibfk_2` FOREIGN KEY (`TagID`) REFERENCES `tags` (`TagID`),
  CONSTRAINT `users_tags_ibfk_1` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `views` (
  `ViewID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int(10) unsigned,
  `QuestionID` bigint(20) unsigned NOT NULL,
  `IPAddress` varchar(15),
  PRIMARY KEY (`ViewID`),
  KEY `UserID` (`UserID`),
  KEY `QuestionID` (`QuestionID`),
  CONSTRAINT `views_ibfk_1` FOREIGN KEY (`UserID`) REFERENCES `users` (`UserID`),
  CONSTRAINT `views_ibfk_2` FOREIGN KEY (`QuestionID`) REFERENCES `questions` (`QuestionID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;


CREATE DATABASE kms;

USE kms;

CREATE TABLE IF NOT EXISTS `users` (
  `UserID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `FirstName` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `LastName` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  `Username` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `Password` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `Email` varchar(100) COLLATE utf8_unicode_ci NOT NULL,
  `RegistrationDate` datetime NOT NULL,
  `Key` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `ConfirmAccount` tinyint(1) NOT NULL DEFAULT '0',
  `UserType` enum('admin','user') COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`UserID`),
  UNIQUE KEY `Email` (`Email`),
  UNIQUE KEY `Username` (`Username`),
  UNIQUE KEY `Key` (`Key`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `questions` (
  `QuestionID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `Title` varchar(250) COLLATE utf8_unicode_ci NOT NULL,
  `Tags` varchar(250) COLLATE utf8_unicode_ci NOT NULL,
  `Question` text COLLATE utf8_unicode_ci NOT NULL,
  `Views` int unsigned DEFAULT 0,
  `UserID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`QuestionID`),
  CONSTRAINT fk_questions_users FOREIGN KEY(UserID) REFERENCES users(UserID)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `answers` (
  `AnswerID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int unsigned NOT NULL,
  `QuestionID` bigint unsigned NOT NULL,
  `Answer` text COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`AnswerID`),
  CONSTRAINT fk_answers_questions FOREIGN KEY(`QuestionID`) REFERENCES questions(`QuestionID`),
  CONSTRAINT fk_answers_users FOREIGN KEY(`UserID`) REFERENCES users(`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `votes` (
  `VoteID` bigint unsigned NOT NULL AUTO_INCREMENT,
  `UserID` int unsigned NOT NULL,
  `QuestionID` bigint unsigned,
  `AnswerID` bigint unsigned,
  PRIMARY KEY (`VoteID`),
  CONSTRAINT fk_votes_questions FOREIGN KEY(`QuestionID`) REFERENCES questions(`QuestionID`),
  CONSTRAINT fk_votes_answers FOREIGN KEY(`AnswerID`) REFERENCES answers(`AnswerID`),
  CONSTRAINT fk_votes_users FOREIGN KEY(`UserID`) REFERENCES users(`UserID`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci AUTO_INCREMENT=1 ;

